{
  "info": {
    "_postman_id": "phonepe-autopay-complete-2026",
    "name": "PhonePe AutoPay API - Complete Collection",
    "description": "‚úÖ Complete PhonePe AutoPay API Collection with Proper Responses\n\nüî• NO CSRF TOKEN REQUIRED - These are API routes!\n\nüìç All endpoints are under /api/ route\n\nüéØ Uses production OAuth credentials\n\nüìù Based on PhonePeAutoPayController implementation",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "2.0.0"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost/git_jignasha/craftyart/public",
      "type": "string"
    },
    {
      "key": "api_base_url",
      "value": "http://localhost/git_jignasha/craftyart/public/api",
      "type": "string"
    },
    {
      "key": "merchant_subscription_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "merchant_order_id",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. PhonePe AutoPay APIs",
      "item": [
        {
          "name": "Setup AutoPay Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.respoutonse.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.success && jsonData.data) {",
                  "        if (jsonData.data.merchant_subscription_id) {",
                  "            pm.collectionVariables.set('merchant_subscription_id', jsonData.data.merchant_subscription_id);",
                  "            console.log('‚úÖ Saved merchant_subscription_id:', jsonData.data.merchant_subscription_id);",
                  "        }",
                  "        if (jsonData.data.merchant_order_id) {",
                  "            pm.collectionVariables.set('merchant_order_id', jsonData.data.merchant_order_id);",
                  "            console.log('‚úÖ Saved merchant_order_id:', jsonData.data.merchant_order_id);",
                  "        }",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"user_id\": \"test_user_123\",\n    \"plan_id\": \"plan_monthly_99\",\n    \"amount\": 1,\n    \"upi\": \"vrajsurani606@okaxis\",\n    \"target_app\": \"com.phonepe.app\"\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/phonepe/autopay/setup",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "phonepe",
                "autopay",
                "setup"
              ]
            },
            "description": "Creates a new AutoPay subscription setup request.\n\n**Request Body:**\n- `user_id` (required): User identifier\n- `plan_id` (required): Subscription plan ID\n- `amount` (required): Amount in rupees (minimum 1)\n- `upi` (optional): User's UPI ID\n- `target_app` (optional): Target UPI app\n\n**Response:**\n- `merchant_order_id`: Your order ID\n- `merchant_subscription_id`: Your subscription ID (SAVE THIS!)\n- `phonepe_order_id`: PhonePe's order ID\n- `redirect_url`: URL to redirect user for payment\n- `state`: Current state (PENDING)\n\n**What Happens:**\n1. Creates Order in database\n2. Generates OAuth token automatically\n3. Sends subscription setup request to PhonePe\n4. Returns redirect URL for user to complete payment\n5. User approves mandate on their phone\n\n**‚ö†Ô∏è NO CSRF TOKEN NEEDED - This is an API route!**"
          },
          "response": [
            {
              "name": "Success Response",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"user_id\": \"test_user_123\",\n    \"plan_id\": \"plan_monthly_99\",\n    \"amount\": 1,\n    \"upi\": \"vrajsurani606@okaxis\",\n    \"target_app\": \"com.phonepe.app\"\n}"
                },
                "url": {
                  "raw": "{{api_base_url}}/phonepe/autopay/setup",
                  "host": [
                    "{{api_base_url}}"
                  ],
                  "path": [
                    "phonepe",
                    "autopay",
                    "setup"
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"success\": true,\n    \"message\": \"Subscription setup initiated successfully\",\n    \"data\": {\n        \"merchant_order_id\": \"MO_SETUP_65d8f1234567890\",\n        \"merchant_subscription_id\": \"MS_65d8f1234567891\",\n        \"phonepe_order_id\": \"PP_ORD_123456789\",\n        \"redirect_url\": \"https://mercury-uat.phonepe.com/transact/pg?token=abc123xyz\",\n        \"state\": \"PENDING\",\n        \"expire_at\": 1708345200000\n    }\n}"
            },
            {
              "name": "User Not Found",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"user_id\": \"invalid_user\",\n    \"plan_id\": \"plan_monthly_99\",\n    \"amount\": 1\n}"
                },
                "url": {
                  "raw": "{{api_base_url}}/phonepe/autopay/setup",
                  "host": [
                    "{{api_base_url}}"
                  ],
                  "path": [
                    "phonepe",
                    "autopay",
                    "setup"
                  ]
                }
              },
              "status": "Not Found",
              "code": 404,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"success\": false,\n    \"message\": \"User not found\"\n}"
            },
            {
              "name": "Authorization Failed",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"user_id\": \"test_user_123\",\n    \"plan_id\": \"plan_monthly_99\",\n    \"amount\": 1\n}"
                },
                "url": {
                  "raw": "{{api_base_url}}/phonepe/autopay/setup",
                  "host": [
                    "{{api_base_url}}"
                  ],
                  "path": [
                    "phonepe",
                    "autopay",
                    "setup"
                  ]
                }
              },
              "status": "Bad Request",
              "code": 400,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"success\": false,\n    \"message\": \"PhonePe Authorization Failed\",\n    \"error\": \"Authorization failed. Please check credentials.\",\n    \"details\": {\n        \"code\": \"AUTHORIZATION_FAILED\",\n        \"message\": \"Invalid credentials\"\n    }\n}"
            }
          ]
        },
        {
          "name": "Get Subscription Status",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{api_base_url}}/phonepe/autopay/status/{{merchant_subscription_id}}",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "phonepe",
                "autopay",
                "status",
                "{{merchant_subscription_id}}"
              ]
            },
            "description": "Checks the current status of a subscription.\n\n**URL Parameter:**\n- `merchant_subscription_id`: The subscription ID from setup response\n\n**Response:**\n- `local_status`: Status in your database\n- `phonepe_status`: Current status from PhonePe\n- `details`: Complete subscription details\n\n**Possible States:**\n- `PENDING`: User hasn't approved yet\n- `ACTIVE`: ‚úÖ Subscription is active and ready\n- `COMPLETED`: Subscription completed\n- `FAILED`: Setup failed\n- `CANCELLED`: User cancelled\n\n**Use this to:**\n- Verify user has approved mandate\n- Check before triggering redemption\n- Monitor subscription health\n\n**‚ö†Ô∏è NO CSRF TOKEN NEEDED - This is an API route!**"
          },
          "response": [
            {
              "name": "Active Subscription",
              "originalRequest": {
                "method": "GET",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{api_base_url}}/phonepe/autopay/status/MS_65d8f1234567891",
                  "host": [
                    "{{api_base_url}}"
                  ],
                  "path": [
                    "phonepe",
                    "autopay",
                    "status",
                    "MS_65d8f1234567891"
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"success\": true,\n    \"data\": {\n        \"local_status\": \"ACTIVE\",\n        \"phonepe_status\": \"ACTIVE\",\n        \"details\": {\n            \"state\": \"ACTIVE\",\n            \"merchantSubscriptionId\": \"MS_65d8f1234567891\",\n            \"subscriptionId\": \"PP_SUB_123456789\",\n            \"amount\": 100,\n            \"currency\": \"INR\",\n            \"frequency\": \"Monthly\",\n            \"startDate\": \"2026-02-18\",\n            \"nextBillingDate\": \"2026-03-18\",\n            \"expireAt\": 1739836800000\n        }\n    }\n}"
            },
            {
              "name": "Pending Subscription",
              "originalRequest": {
                "method": "GET",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{api_base_url}}/phonepe/autopay/status/MS_65d8f1234567891",
                  "host": [
                    "{{api_base_url}}"
                  ],
                  "path": [
                    "phonepe",
                    "autopay",
                    "status",
                    "MS_65d8f1234567891"
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"success\": true,\n    \"data\": {\n        \"local_status\": \"PENDING\",\n        \"phonepe_status\": \"PENDING\",\n        \"details\": {\n            \"state\": \"PENDING\",\n            \"merchantSubscriptionId\": \"MS_65d8f1234567891\",\n            \"message\": \"User approval pending\"\n        }\n    }\n}"
            },
            {
              "name": "Subscription Not Found",
              "originalRequest": {
                "method": "GET",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{api_base_url}}/phonepe/autopay/status/MS_INVALID",
                  "host": [
                    "{{api_base_url}}"
                  ],
                  "path": [
                    "phonepe",
                    "autopay",
                    "status",
                    "MS_INVALID"
                  ]
                }
              },
              "status": "Not Found",
              "code": 404,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"success\": false,\n    \"message\": \"Subscription not found\"\n}"
            }
          ]
        },
        {
          "name": "Trigger Manual Redemption",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"merchant_subscription_id\": \"{{merchant_subscription_id}}\"\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/phonepe/autopay/redeem",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "phonepe",
                "autopay",
                "redeem"
              ]
            },
            "description": "Triggers manual redemption (auto-debit) for an active subscription.\n\n**‚ö†Ô∏è IMPORTANT NOTES:**\n\n1. **Sandbox Limitation:**\n   - PhonePe Sandbox does NOT support redemption API\n   - You'll get \"AUTHORIZATION_FAILED\" or 204 No Content\n   - This is NORMAL in sandbox environment\n\n2. **Production Only:**\n   - Redemption API only works with production credentials\n   - Requires live UPI mandate approved by user\n   - Will charge real money from user's account\n\n3. **Testing in Sandbox:**\n   - You can only test subscription SETUP in sandbox\n   - Cannot test actual auto-debit in sandbox\n   - Use production for full testing\n\n**Request Body:**\n- `merchant_subscription_id` (required): Subscription ID from setup\n\n**Prerequisites:**\n- Subscription must be ACTIVE\n- User must have approved mandate\n- Cannot trigger twice in same day\n\n**Response (Production):**\n- `merchant_order_id`: New order ID for this redemption\n- `phonepe_order_id`: PhonePe's order ID\n- Transaction record created in database\n\n**Response (Sandbox):**\n- Error message explaining sandbox limitation\n- Details about subscription\n- Note about production requirement\n\n**‚ö†Ô∏è NO CSRF TOKEN NEEDED - This is an API route!**"
          },
          "response": [
            {
              "name": "Success (Production)",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"merchant_subscription_id\": \"MS_65d8f1234567891\"\n}"
                },
                "url": {
                  "raw": "{{api_base_url}}/phonepe/autopay/redeem",
                  "host": [
                    "{{api_base_url}}"
                  ],
                  "path": [
                    "phonepe",
                    "autopay",
                    "redeem"
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"success\": true,\n    \"message\": \"Manual redemption triggered\",\n    \"data\": {\n        \"merchant_order_id\": \"MO_MANUAL_65d8f9876543210\",\n        \"phonepe_order_id\": \"PP_ORD_987654321\"\n    }\n}"
            },
            {
              "name": "Sandbox Limitation",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"merchant_subscription_id\": \"MS_65d8f1234567891\"\n}"
                },
                "url": {
                  "raw": "{{api_base_url}}/phonepe/autopay/redeem",
                  "host": [
                    "{{api_base_url}}"
                  ],
                  "path": [
                    "phonepe",
                    "autopay",
                    "redeem"
                  ]
                }
              },
              "status": "Bad Request",
              "code": 400,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"success\": false,\n    \"message\": \"PhonePe Subscription Redemption API Not Available in Sandbox\",\n    \"error\": \"The subscription redemption/auto-debit API is only available in production environment. In sandbox, you can only test subscription setup.\",\n    \"details\": {\n        \"subscription_id\": 123,\n        \"merchant_subscription_id\": \"MS_65d8f1234567891\",\n        \"amount\": 1,\n        \"next_billing_date\": \"2026-03-18\",\n        \"http_code\": 204,\n        \"note\": \"To test auto-debit, you need production credentials and a live UPI mandate.\"\n    }\n}"
            },
            {
              "name": "Already Processed Today",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"merchant_subscription_id\": \"MS_65d8f1234567891\"\n}"
                },
                "url": {
                  "raw": "{{api_base_url}}/phonepe/autopay/redeem",
                  "host": [
                    "{{api_base_url}}"
                  ],
                  "path": [
                    "phonepe",
                    "autopay",
                    "redeem"
                  ]
                }
              },
              "status": "Bad Request",
              "code": 400,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"success\": false,\n    \"message\": \"Manual redemption already triggered today\"\n}"
            },
            {
              "name": "Subscription Not Found",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"merchant_subscription_id\": \"MS_INVALID\"\n}"
                },
                "url": {
                  "raw": "{{api_base_url}}/phonepe/autopay/redeem",
                  "host": [
                    "{{api_base_url}}"
                  ],
                  "path": [
                    "phonepe",
                    "autopay",
                    "redeem"
                  ]
                }
              },
              "status": "Not Found",
              "code": 404,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"success\": false,\n    \"message\": \"Active subscription not found\"\n}"
            }
          ]
        },
        {
          "name": "Cancel Subscription",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"merchant_subscription_id\": \"{{merchant_subscription_id}}\"\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/phonepe/autopay/cancel",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "phonepe",
                "autopay",
                "cancel"
              ]
            },
            "description": "Cancels an active subscription.\n\n**Request Body:**\n- `merchant_subscription_id` (required): Subscription ID to cancel\n\n**What Happens:**\n1. Sends cancellation request to PhonePe\n2. Updates local database status to CANCELLED\n3. User's mandate is revoked\n4. No more auto-debits will occur\n\n**Response:**\n- Success message if cancelled\n- Error if subscription not found or already cancelled\n\n**Use Cases:**\n- User wants to stop subscription\n- Refund scenario\n- Plan downgrade\n- Account closure\n\n**‚ö†Ô∏è NO CSRF TOKEN NEEDED - This is an API route!**"
          },
          "response": [
            {
              "name": "Success",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"merchant_subscription_id\": \"MS_65d8f1234567891\"\n}"
                },
                "url": {
                  "raw": "{{api_base_url}}/phonepe/autopay/cancel",
                  "host": [
                    "{{api_base_url}}"
                  ],
                  "path": [
                    "phonepe",
                    "autopay",
                    "cancel"
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"success\": true,\n    \"message\": \"Subscription cancelled successfully\"\n}"
            },
            {
              "name": "Subscription Not Found",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"merchant_subscription_id\": \"MS_INVALID\"\n}"
                },
                "url": {
                  "raw": "{{api_base_url}}/phonepe/autopay/cancel",
                  "host": [
                    "{{api_base_url}}"
                  ],
                  "path": [
                    "phonepe",
                    "autopay",
                    "cancel"
                  ]
                }
              },
              "status": "Not Found",
              "code": 404,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"success\": false,\n    \"message\": \"Subscription not found\"\n}"
            }
          ]
        }
      ]
    },
    {
      "name": "2. Web Routes (Browser Only)",
      "item": [
        {
          "name": "Simple Payment Test Page",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/phonepe/simple-payment-test",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "phonepe",
                "simple-payment-test"
              ]
            },
            "description": "Opens the PhonePe Simple Payment Test page in browser.\n\n**‚ö†Ô∏è This is a WEB route, not API!**\n\n**Requirements:**\n- Must be logged in as Admin\n- Browser access only\n- CSRF token handled automatically by Laravel\n\n**Features:**\n- Interactive payment request form\n- Real-time transaction history\n- Action buttons for each transaction\n- Copy IDs functionality\n\n**Note:** Open this URL in your browser after logging in as admin."
          },
          "response": []
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// No pre-request script needed",
          "// OAuth token is handled automatically by the API"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Auto-save merchant_subscription_id and merchant_order_id from responses",
          "if (pm.response.code === 200) {",
          "    var jsonData = pm.response.json();",
          "    if (jsonData.success && jsonData.data) {",
          "        if (jsonData.data.merchant_subscription_id) {",
          "            pm.collectionVariables.set('merchant_subscription_id', jsonData.data.merchant_subscription_id);",
          "            console.log('‚úÖ Saved merchant_subscription_id:', jsonData.data.merchant_subscription_id);",
          "        }",
          "        if (jsonData.data.merchant_order_id) {",
          "            pm.collectionVariables.set('merchant_order_id', jsonData.data.merchant_order_id);",
          "            console.log('‚úÖ Saved merchant_order_id:', jsonData.data.merchant_order_id);",
          "        }",
          "    }",
          "}",
          "",
          "// Log response for debugging",
          "console.log('Response Status:', pm.response.code);",
          "console.log('Response Body:', pm.response.text());"
        ]
      }
    }
  ]
}